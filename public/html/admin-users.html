<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Users - SPC Alerts</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../css/admin-dashboard.css?v=12">

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/img/icon-192.png">
  <link rel="apple-touch-icon" href="/img/icon-192.png">
  <script src="../javascript/pwa.js" defer></script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      // Try absolute path first
      let registration = await navigator.serviceWorker.register('/service-worker.js', {
        scope: '/'
      });
      console.log('✅ Service Worker registered:', registration.scope);
      
      // Wait for it to be ready
      await navigator.serviceWorker.ready;
      console.log('✅ Service Worker ready');
      
    } catch (err) {
      console.error('❌ Service Worker registration failed:', err);
      
      // Fallback: try relative path
      try {
        const registration = await navigator.serviceWorker.register('../../../service-worker.js', {
          scope: '/'
        });
        console.log('✅ Service Worker registered (fallback):', registration.scope);
      } catch (fallbackErr) {
        console.error('❌ Fallback also failed:', fallbackErr);
      }
    }
  });
}
</script>
</head>
<body>
  <!-- Admin Header with Navigation Tabs -->
  <header class="admin-header">
    <div class="admin-container">
      <div class="dashboard-header">
        <h1><i class="fas fa-shield-alt"></i> SPC Alerts</h1>

        <div class="header-right">
            <div class="admin-badge">
                <i class="fas fa-user-shield"></i> Administrator
            </div>

          <div class="admin-nav-tabs">
            <a href="admin-dashboard.html" class="nav-tab">
              <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="admin-users.html" class="nav-tab active">
              <i class="fas fa-users"></i> Users
            </a>
            <a href="admin-incident.html" class="nav-tab">
              <i class="fas fa-exclamation-triangle"></i> Incidents
            </a>
            <a href="admin-sos.html" class="nav-tab">
              <i class="fas fa-ambulance"></i> SOS
            </a>
        </div>

          <div class="header-actions">
            <button id="installBtn" class="install-btn" style="display:none;">
              <i class="fas fa-download"></i>
            </button>
            <button class="logout-btn" onclick="logout()">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="admin-main">
    <div class="admin-container">

      <!-- Page Title -->
      <div style="margin-bottom: 32px; text-align: center;">
        <h2 style="color: var(--admin); font-size: 2rem; margin: 0;">
          User Management
        </h2>
      </div>

      <!-- Add User Button -->
      <div class="admin-actions" style="margin-bottom: 32px; text-align: right;">
        <button class="action-btn" id="addUserBtn">
          <i class="fas fa-user-plus"></i> Add New User
        </button>
      </div>

        <!-- Search and Filter -->
        <div class="admin-actions" style="margin-bottom:24px; display:flex; gap:16px; flex-wrap:wrap; align-items:center;">
  <input type="text" id="userSearch" placeholder="Search users..." style="padding:12px 16px; border:2px solid #ddd; border-radius:12px; width:300px; max-width:100%;">
  <select id="userFilter" style="padding:12px; border:2px solid #ddd; border-radius:12px;">
    <option value="all">All Users</option>
    <option value="active">Active Only</option>
  </select>
</div>

      <!-- Users Table -->
      <div class="user-list">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Address</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Filled by admin.js -->
          </tbody>
        </table>
      </div>

    </div>
  </main>

  <footer>
        <div class="footer-emergency">
            <h3>EMERGENCY PHONE NUMBERS</h3>
            <div class="emergency-list">
                <div class="emergency-item">
                    <span class="emergency-label">National Emergency Hotline</span>
                    <span class="emergency-number">911</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">Philippine Red Cross (PRC)</span>
                    <span class="emergency-number">143 or (02) 8790-2300</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">NDRRMC</span>
                    <span class="emergency-number">(02) 8911-5061 to 65</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">Philippine National Police (PNP)</span>
                    <span class="emergency-number">117 or (02) 8722-0650</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">Bureau of Fire Protection (BFP)</span>
                    <span class="emergency-number">(02) 8426-0219 or (02) 8426-0246</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">Philippine Coast Guard (PCG)</span>
                    <span class="emergency-number">(02) 8527-3877</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">DSWD</span>
                    <span class="emergency-number">(02) 8931-8101</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">PAGASA (Weather Updates)</span>
                    <span class="emergency-number">(02) 8284-0800</span>
                </div>
            </div>
        </div>

        <div class="copyright">
            <p>© 2025 SPC Alerts • To God Be The Glory</p>
        </div>
    </footer>

  <!-- User Modal (Add/Edit) - Reused from dashboard -->
  <div id="userModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Add New User</h2>
        <span class="close">×</span>
      </div>
      <form id="userForm">
        <input type="hidden" id="userId">

        <div class="form-group">
          <label>First Name</label>
          <input type="text" id="first_name" required>
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <input type="text" id="last_name" required>
        </div>
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="username" placeholder="@johndoe" required>
        </div>
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" id="phone" placeholder="+639171234567" required>
        </div>
        <div class="form-group">
          <label>Address</label>
          <input type="text" id="address" required>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="email" required>
        </div>
        <div class="form-group" id="passwordGroup">
          <label>Password <small>(leave blank to keep current)</small></label>
          <input type="password" id="password" minlength="6">
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-save">Save User</button>
          <button type="button" class="btn-cancel">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Supabase Client -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
    const supabaseUrl = 'https://oqmfjwlpuwfpbnpiavhp.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xbWZqd2xwdXdmcGJucGlhdmhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4OTgxNzYsImV4cCI6MjA3OTQ3NDE3Nn0.yywiH3q3g1Rbyypt5mxvhRgDXZrSFENZn5s1EWVp8Z8';
    window.supabase = createClient(supabaseUrl, supabaseAnonKey);
    window.supabase.auth.onAuthStateChange((event) => {
      if (event === 'SIGNED_OUT' && !location.pathname.includes('login.html')) {
        location.href = '/public/html/login.html';
      }
    });
    window.dispatchEvent(new Event('supabase-ready'));
  </script>

  <!-- Reuses your existing admin.js (handles everything: auth guard, load users, modal, edit/delete) -->
  <script src="../javascript/admin.js" defer></script>
  <script src="../javascript/keep-alive.js" type="module"></script>
  
</body>
</html>
