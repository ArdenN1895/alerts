<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPC Alerts - Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/profile.css">

    <!-- PWA Stuff -->
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/img/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="SPC Alerts">
    <link rel="apple-touch-icon" href="/img/icon-192.png">

    <!-- CRITICAL: Load Supabase as MODULE -->
    <script type="module" src="../javascript/profile.js"></script>

    <!-- PWA Install Button (shared) -->
    <script src="../javascript/pwa.js" defer></script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      // Try absolute path first
      let registration = await navigator.serviceWorker.register('/service-worker.js', {
        scope: '/'
      });
      console.log('✅ Service Worker registered:', registration.scope);
      
      // Wait for it to be ready
      await navigator.serviceWorker.ready;
      console.log('✅ Service Worker ready');
      
    } catch (err) {
      console.error('❌ Service Worker registration failed:', err);
      
      // Fallback: try relative path
      try {
        const registration = await navigator.serviceWorker.register('../../../service-worker.js', {
          scope: '/'
        });
        console.log('✅ Service Worker registered (fallback):', registration.scope);
      } catch (fallbackErr) {
        console.error('❌ Fallback also failed:', fallbackErr);
      }
    }
  });
}
</script>
</head>
<body>
    <header>
        <div class="header-top">
            <div class="logo">
                <a href="index.html">SPC Alerts</a>
            </div>
            <div class="header-actions">
                <button id="installBtn" class="install-btn" style="display:none;"><i class="fas fa-download"></i></button>
                <a href="#" class="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
    </header>

    <nav>   
    <div class="nav-container">

        <ul class="main-nav" id="mainNav">
            <li><a href="map.html">Map</a></li>
            <li><a href="live-broadcast.html">Live Broadcast</a></li>
            <li><a href="news-outlet.html">News Outlet</a></li>
            <li><a href="donation.html">Donation</a></li>
            <li><a href="profile.html" class="active">Profile</a></li>
            <li><a href="about-us.html">About Us</a></li>
        </ul>

        <!-- Correct burger button -->
        <button class="burger" id="burgerBtn">
            <span></span>
            <span></span>
            <span></span>
        </button>

    </div>
</nav>

    <!-- Profile Container - FULL WIDTH STACKED LAYOUT -->
<div class="profile-main-container">
    <!-- User Profile Card (Top) -->
    <div class="profile-card">
        <div class="profile-header-centered">
            <div class="profile-avatar">
                <i class="fas fa-user"></i>
            </div>
            <h2 class="profile-name">Loading...</h2>
            <p class="profile-role">Community Member</p>
        </div>

        <!-- Personal Information Form -->
        <section class="profile-section active">
            <div class="section-header">
                <h2>Personal Information</h2>
            </div>

            <form class="profile-form">
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" placeholder="Loading...">
                </div>
                <div class="form-group">
                    <label for="phoneNumber">Phone Number</label>
                    <input type="tel" id="phoneNumber" placeholder="Loading...">
                </div>
                <div class="form-group">
                    <label for="address">Address</label>
                    <input type="text" id="address" placeholder="Loading...">
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </section>

        <!-- Emergency Contact Section (Now Editable) -->
<section class="profile-section" style="margin-top: 40px;">
    <div class="section-header">
        <h2>Emergency Contact Person</h2>
        <p>In case of emergency, this person will be notified</p>
    </div>

    <div class="emergency-contact-card">
        <!-- Loading -->
        <div id="contact-loading">
            <i class="fas fa-spinner fa-spin"></i> Loading contact...
        </div>

        <!-- Display Mode -->
        <div id="contact-display" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <h3 style="margin: 0 0 10px 0; color: #005ea5;">
                        <i class="fas fa-user-circle"></i> 
                        <span id="contact-name">—</span>
                    </h3>
                    <p style="margin: 5px 0; color: #333;">
                        <i class="fas fa-heart"></i> 
                        <strong id="contact-relationship">—</strong> • 
                        <span id="contact-phone">—</span>
                    </p>
                </div>
                <button id="editContactBtn" class="btn-primary" style="padding: 8px 16px; font-size: 14px;">
                    <i class="fas fa-edit"></i> Edit
                </button>
            </div>
        </div>

        <!-- No Contact Yet -->
        <div id="no-contact" style="text-align: center; color: #999; display: none;">
            <i class="fas fa-exclamation-triangle" style="font-size: 2.5rem; margin-bottom: 12px; color: #e67e22;"></i>
            <p>No emergency contact added yet.</p>
            <button id="addContactBtn" class="btn-primary" style="margin-top: 12px;">
                <i class="fas fa-plus"></i> Add Emergency Contact
            </button>
        </div>

        <!-- Edit / Add Form (Hidden by default) -->
        <div id="contact-form-container" style="display: none; margin-top: 20px;">
            <form id="emergencyContactForm">
                <div class="form-group">
                    <label for="ecFirstName">First Name <span class="required">*</span></label>
                    <input type="text" id="ecFirstName" required>
                </div>
                <div class="form-group">
                    <label for="ecLastName">Last Name</label>
                    <input type="text" id="ecLastName">
                </div>
                <div class="form-group">
                    <label for="ecRelationship">Relationship <span class="required">*</span></label>
                    <select id="ecRelationship" required style="width: 100%; padding: 14px 16px; border: 1.5px solid #ddd; border-radius: 8px; font-size: 16px; background-color: #fdfdfd;">
                        <option value="" disabled selected>Select relationship...</option>
                        <option value="spouse">Spouse</option>
                        <option value="parent">Parent</option>
                        <option value="child">Child</option>
                        <option value="sibling">Sibling</option>
                        <option value="friend">Friend</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="ecPhone">Phone Number <span class="required">*</span></label>
                    <input type="tel" id="ecPhone" required>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Save Contact
                    </button>
                    <button type="button" id="cancelEditBtn" class="btn-outline">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>
</div> 
</div>    


<footer>
        <div class="footer-emergency">
            <h3>EMERGENCY PHONE NUMBERS</h3>
            <div class="emergency-list">
                <div class="emergency-item">
                    <span class="emergency-label">National Emergency Hotline</span>
                    <span class="emergency-number">911</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">Philippine Red Cross (PRC)</span>
                    <span class="emergency-number">143 or (02) 8790-2300</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">NDRRMC</span>
                    <span class="emergency-number">(02) 8911-5061 to 65</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">Philippine National Police (PNP)</span>
                    <span class="emergency-number">117 or (02) 8722-0650</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">Bureau of Fire Protection (BFP)</span>
                    <span class="emergency-number">(02) 8426-0219 or (02) 8426-0246</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">Philippine Coast Guard (PCG)</span>
                    <span class="emergency-number">(02) 8527-3877</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">DSWD</span>
                    <span class="emergency-number">(02) 8931-8101</span>
                </div>
                <div class="emergency-item">
                    <span class="emergency-label">PAGASA (Weather Updates)</span>
                    <span class="emergency-number">(02) 8284-0800</span>
                </div>
            </div>
        </div>

        <div class="copyright">
            <p>© 2025 SPC Alerts • To God Be The Glory</p>
        </div>
    </footer>

<script>
document.querySelectorAll('.logout').forEach(el => {
    el.addEventListener('click', e => {
        e.preventDefault();
        if (confirm('Logout from SPC Alerts?')) {
            localStorage.clear();
            window.location.href = '../html/login.html';
        }
    });
});
</script>
    <script src="../javascript/keep-alive.js" type="module"></script>
</body>
</html>
